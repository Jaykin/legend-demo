<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>03_builtin_components</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>
    <div id="app">
        <!-- 无组件缓存 -->
        <component :is="currComp"></component>

        <!-- 有组件缓存 -->
        <keep-alive>
            <component :is="currComp"></component>
        </keep-alive>

        <!-- transition -->

        <!-- 异步组件A -->
        <div style="width: 200px;height:50px;line-height:50px;text-align: center;border: 1px solid red;">
            <comp-async-a></comp-async-a>
        </div>

        <!-- 异步组件B -->
        <div style="width: 200px;height:50px;line-height:50px;text-align: center;border: 1px solid red;">
            <comp-async-b></comp-async-b>
        </div>
    </div>
    <script name="子组件定义">
        // 组件A
        const CompA = {
            name: 'CompA',
            data() {
                return {
                    name: "I am CompA!"
                }
            },
            template: `
                <div>{{name}}</div>
            `,
            created() {
                console.log('CompA created!');
            },
            destoryed() {
                console.log('CompA destoryed!');
            }
        }

        // 组件B
        const CompB = {
            name: 'CompB',
            data() {
                return {
                    name: "I am CompB!"
                }
            },
            template: `
                <div>{{name}}</div>
            `,
            created() {
                console.log('CompB created!');
            },
            destoryed() {
                console.log('CompB destoryed!');
            }
        }

        // 组件C
        const CompC = {
            name: 'CompC',
            data() {
                return {
                    name: "I am CompC!"
                }
            },
            template: `
                <div>{{name}}</div>
            `,
            created() {
                console.log('CompC created!');
            },
            destoryed() {
                console.log('CompC destoryed!');
            }
        }

        // 异步组件A - 异步函数定义
        const CompAsyncA = function (resolve, reject) {
            setTimeout(function () {
                const comp = {
                    name: "CompAsyncA",
                    template: `<div>I am CompAsyncA!</div>`
                };
                resolve(comp);
            }, 3000);
        }

        // 异步组件B - 配置对象
        const CompAsyncB = function () {
            return {
                // 需要加载的组件 (应该是一个 `Promise` 对象)
                component: new Promise(function (resolve, reject) {
                    setTimeout(function () {
                        const comp = {
                            name: "CompAsyncB",
                            template: `<div>I am CompAsyncB!</div>`
                        };
                        resolve(comp);
                    }, 3000);
                }),
                // 异步组件加载时使用的组件
                loading: {
                    template: `<div>loading...</div>`
                },
                // 加载失败时使用的组件
                error: {
                    template: `<div>load error</div>`
                },
                // 展示加载时组件的延时时间。默认值是 200 (毫秒)
                delay: 200,
                // 如果提供了超时时间且组件加载也超时了，
                // 则使用加载失败时使用的组件。默认值是：`Infinity`
                timeout: 4000
            }
        }
    </script>
    <script>
        new Vue({
            el: '#app',
            components: {
                CompA,
                CompB,
                CompC,
                CompAsyncA,
                CompAsyncB
            },
            data: {
                // currComp: 'CompA'  // 组件名称（name）
                currComp: CompA
            },
            mounted() {
                const vm = this;
                const list = ['A', 'B', 'C'];
                let i = 0;

                // setInterval(function () {
                //     vm.currComp = `Comp${list[i]}`;

                //     if (++i >= 3) {
                //         i = 0;
                //     }
                //     // console.log(vm.$children); // 查看子组件数量的变化
                // }, 2000);

                // mixin 策略
                console.log('Vue.config.optionMergeStrategies: ', Vue.config.optionMergeStrategies);
            }
        });
    </script>
</body>
</html>