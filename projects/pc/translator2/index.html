<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8" />
    <title>translator</title>
  </head>
  <style>
    /*隐藏滚动条*/
    body::-webkit-scrollbar { display: none; }
    button {
      display: inline-block;
      color: #000;
      border: 1px solid #000;
      padding: 0;
      margin: 5px 0;
      cursor: pointer;
    }
  </style>
  <body>
    <textarea name="source" id="source" cols="10" rows="2"></textarea>
    <button id="enBtn">英/中</button>
    <button id="cnBtn">中/英</button>
    <textarea name="target" id="target" cols="10" rows="2"></textarea>
  </body>
  <script>
    // 自动打开调试面板
    const win = nw.Window.get();
    win.showDevTools();
    // reload
    const fs = require('fs');
    fs.watchFile('index.html', () => {
        win.reload();
    });

    const request = require('superagent');
    const types = {
      '1': 'EN2ZH_CN',  // 英/中
      '2': 'ZH_CN2EN',  // 中/英
    }

    function handleError(err) {
      console.error(err);
      alert(err.msg);
    }

    function translate(type) {
      const sourceDom = document.getElementById('source');
      const targetDom = document.getElementById('target');

      if (sourceDom.value) {
        request.get('http://fanyi.youdao.com/translate')
          .query({
            doctype: 'json',
            type: types[type],
            i: sourceDom.value,
          })
          .then(res => {
            if (res.body.errorCode === 0) {
              // 翻译成功
              let ret = '';
              res.body.translateResult.forEach(item => {
                item.forEach(it => {
                  ret += (it.tgt + '\n');
                });
              });
              targetDom.value = ret;
            } else {
              // 翻译出错
              handleError({
                type: 'translate',
                msg: res.body.toString()
              });
            }
          })
          .catch(err => {
            handleError({
              type: 'network',
              msg: err.toString()
            })
          })
      } else {
        handleError({
          msg: '请输入需要翻译的内容'
        });
      }
    }

    // 英/中
    document.getElementById('enBtn').addEventListener('click', () => {
      translate(1);
    });

    // 中/英
    document.getElementById('cnBtn').addEventListener('click', () => {
      translate(2);
    });
  </script>
</html>